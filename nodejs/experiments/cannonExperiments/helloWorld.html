
<!DOCTYPE html>
<html>
  <head>
    <title>three.js / cannon.js example</title>
    <meta charset="utf-8">
    <style>
      * {
        margin:0;
        padding:0
      }
      body {
        overflow:hidden;
      }
    </style>
  </head>
  <body>
    <script src="Three.js"></script>
    <script src="cannon.js"></script>    
    <script>
      // var world, mass, body, shape, timeStep=1/60,
      //    camera, scene, renderer, geometry, material, mesh;
    var world, mass, body, shape, timeStep=1.0/60.0, sphereBody, sphereShape, groundShape, groundBody,
         camera, scene, renderer, geometry, material, mesh, planeGeometry, planeMaterial, planeMesh;

      initThree();
      initCannon();
      animate();

      
function initCannon(){

  world = new CANNON.World();
  world.gravity.set(0,-9.82,0);
  world.broadphase = new CANNON.NaiveBroadphase();
  world.solver.iterations = 10;

  radius = 1;
  sphereShape = new CANNON.Sphere(radius);
  sphereBody = new CANNON.Body({
    mass: 5
  });
  sphereBody.addShape(sphereShape);
  sphereBody.angularVelocity.set(0,10,0);
  sphereBody.angularDamping = 0.5;
  sphereBody.position.set(0,0,0);
  world.addBody(sphereBody);

  groundShape = new CANNON.Plane();
  groundBody = new CANNON.Body(0, groundShape);
  world.add(groundBody);

}

function initThree() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 100 );
    camera.position.z = 5;
    scene.add( camera );

    geometry = new THREE.SphereGeometry(1);
    material = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true} );
    mesh = new THREE.Mesh( geometry, material );
    scene.add( mesh );
    
    planeGeometry = new THREE.PlaneGeometry(4,1);
    planeMaterial = new THREE.MeshBasicMaterial({color:0xff00ff, side:THREE.DoubleSide});
    planeMesh = new THREE.Mesh(planeGeometry, planeMaterial);
    scene.add(planeMesh);

    renderer = new THREE.CanvasRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );
    document.body.appendChild( renderer.domElement );
}


function animate() {
  //for(var i =0; i<60;++i){
    requestAnimationFrame( animate );
    updatePhysics();
    render();
  //}
    
}

function updatePhysics() {
    // Step the physics world
    //for(var i=0;i<60;++i){
      world.step(timeStep);        
    // Copy coordinates from Cannon.js to Three.js
    //console.log(mesh);
      //sphereBody.position.copy(mesh.position);
      //sphereBody.quaternion.copy(mesh.quaternion);
      //console.log(planeMesh);
      // groundBody.position.copy(planeMesh.position);
      // groundBody.quaternion.copy(planeMesh.quaternion);
      
      mesh.position.copy(sphereBody.position);
      mesh.quaternion.copy(sphereBody.quaternion);
      // //console.log(planeMesh);
      planeMesh.position.copy(groundBody.position);
      planeMesh.quaternion.copy(groundBody.quaternion);
  //}
 }
 
 function render() {
    renderer.render( scene, camera );
 }
      
    </script>
  </body>
</html>
